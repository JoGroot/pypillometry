
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Welcome to pypillometry’s documentation! &#8212; pypillometry  documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">pypillometry  documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="welcome-to-pypillometry-s-documentation">
<h1>Welcome to pypillometry’s documentation!<a class="headerlink" href="#welcome-to-pypillometry-s-documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
</div>
<div class="section" id="pypillometry">
<h1>pypillometry<a class="headerlink" href="#pypillometry" title="Permalink to this headline">¶</a></h1>
<a class="reference external image-reference" href="https://raw.githubusercontent.com/ihrke/pypillometry/master/logo/pypillometry_logo_200x200.png?token=AAIWMEINEM6MUOAPT2NV4I252K5QW"><img alt="" src="https://raw.githubusercontent.com/ihrke/pypillometry/master/logo/pypillometry_logo_200x200.png?token=AAIWMEINEM6MUOAPT2NV4I252K5QW" /></a>
<p>pupillometry with python</p>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-conda">
<h3>Using <code class="docutils literal notranslate"><span class="pre">conda</span></code><a class="headerlink" href="#using-conda" title="Permalink to this headline">¶</a></h3>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>$ conda create -n pypil python=3
$ conda activate pypil
$ conda install anaconda
$ conda activate pypil
</pre></div>
</div>
<p>To enable plotting widgets in jupyter notebook and jupyter lab</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>$ conda install ipywidgets nodejs
$ jupyter nbextension enable --py widgetsnbextension
$ jupyter labextension install @jupyter-widgets/jupyterlab-manager
</pre></div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">pystan</span></code>, I needed to do</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pystan</span>
<span class="n">conda</span> <span class="n">install</span> <span class="n">gcc_linux</span><span class="o">-</span><span class="mi">64</span>
<span class="n">conda</span> <span class="n">install</span> <span class="n">gxx_linux</span><span class="o">-</span><span class="mi">64</span>
</pre></div>
</div>
<p>otherwise, there were random crashes of the jupyter kernel for some reason.</p>
</div>
</div>
<div class="section" id="module-pypillometry.fakedata">
<span id="api-documentation"></span><h2>API documentation<a class="headerlink" href="#module-pypillometry.fakedata" title="Permalink to this headline">¶</a></h2>
<div class="section" id="fakedata-py">
<h3>fakedata.py<a class="headerlink" href="#fakedata-py" title="Permalink to this headline">¶</a></h3>
<p>Generate artificial pupil-data.</p>
<dl class="function">
<dt id="pypillometry.fakedata.generate_pupil_data">
<code class="sig-prename descclassname">pypillometry.fakedata.</code><code class="sig-name descname">generate_pupil_data</code><span class="sig-paren">(</span><em class="sig-param">event_onsets</em>, <em class="sig-param">fs=1000</em>, <em class="sig-param">pad=5000</em>, <em class="sig-param">baseline_lowpass=0.2</em>, <em class="sig-param">evoked_response_perc=0.02</em>, <em class="sig-param">response_fluct_sd=1</em>, <em class="sig-param">prf_npar=(10.35</em>, <em class="sig-param">0)</em>, <em class="sig-param">prf_tmax=(917.0</em>, <em class="sig-param">0)</em>, <em class="sig-param">prop_spurious_events=0.2</em>, <em class="sig-param">noise_amp=0.0005</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.fakedata.generate_pupil_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate artificial pupil data as a sum of slow baseline-fluctuations
on which event-evoked responses are “riding”.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>event_onsets</strong> (<em>list</em>) – list of all events that evoke a response (in seconds)</p></li>
<li><p><strong>fs</strong> (<em>float</em>) – sampling rate in Hz</p></li>
<li><p><strong>pad</strong> (<em>float</em>) – append <cite>pad</cite> milliseconds of signal after the last event is decayed</p></li>
<li><p><strong>baseline_lowpass</strong> (<em>float</em>) – cutoff for the lowpass-filter that defines the baseline
(highest allowed frequency in the baseline fluctuations)</p></li>
<li><p><strong>evoked_response_perc</strong> (<em>float</em>) – amplitude of the pupil-response as proportion of the baseline</p></li>
<li><p><strong>response_fluct_sd</strong> (<em>float</em>) – How much do the amplitudes of the individual events fluctuate?
This is determined by drawing each individual pupil-response to
a single event from a (positive) normal distribution with mean as determined
by <cite>evoked_response_perc</cite> and sd <cite>response_fluct_sd</cite> (in units of
<cite>evoked_response_perc</cite>).</p></li>
<li><p><strong>prf_npar</strong> (<em>tuple</em><em> (</em><em>float</em><em>,</em><em>float</em><em>)</em>) – (mean,std) of the npar parameter from <a class="reference internal" href="#pypillometry.pupil.pupil_kernel" title="pypillometry.pupil.pupil_kernel"><code class="xref py py-func docutils literal notranslate"><span class="pre">pypillometry.pupil.pupil_kernel()</span></code></a>.
If the std is exactly zero, then the mean is used for all pupil-responses.
If the std is positive, npar is taken i.i.d. from ~ normal(mean,std) for each event.</p></li>
<li><p><strong>prf_tmax</strong> (<em>tuple</em><em> (</em><em>float</em><em>,</em><em>float</em><em>)</em>) – (mean,std) of the tmax parameter from <a class="reference internal" href="#pypillometry.pupil.pupil_kernel" title="pypillometry.pupil.pupil_kernel"><code class="xref py py-func docutils literal notranslate"><span class="pre">pypillometry.pupil.pupil_kernel()</span></code></a>.
If the std is exactly zero, then the mean is used for all pupil-responses.
If the std is positive, tmax is taken i.i.d. from ~ normal(mean,std) for each event.</p></li>
<li><p><strong>prop_spurious_events</strong> (<em>float</em>) – Add random events to the pupil signal. <cite>prop_spurious_events</cite> is expressed
as proportion of the number of real events.</p></li>
<li><p><strong>noise_amp</strong> (<em>float</em>) – Amplitude of random gaussian noise that sits on top of the simulated signal.
Expressed in units of mean baseline pupil diameter.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>tx, sy</strong> (<em>np.array</em>) – time and simulated pupil-dilation (n)</p></li>
<li><p><strong>x0</strong> (<em>np.array</em>) – baseline (n)</p></li>
<li><p><strong>delta_weights</strong> (<em>np.array</em>) – pupil-response strengths (len(event_onsets))</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pypillometry.fakedata.get_dataset">
<code class="sig-prename descclassname">pypillometry.fakedata.</code><code class="sig-name descname">get_dataset</code><span class="sig-paren">(</span><em class="sig-param">ntrials=100</em>, <em class="sig-param">isi=2000</em>, <em class="sig-param">rtdist=(1000</em>, <em class="sig-param">500)</em>, <em class="sig-param">fs=1000</em>, <em class="sig-param">pad=5000</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.fakedata.get_dataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience function to run <a class="reference internal" href="#pypillometry.fakedata.generate_pupil_data" title="pypillometry.fakedata.generate_pupil_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">generate_pupil_data()</span></code></a> with standard parameters.
:param ntrials: number of trials
:type ntrials: int
:param isi: inter-stimulus interval in milliseconds
:type isi: float
:param rtdist: mean and std of a (truncated at zero) normal distribution to generate response times
:type rtdist: tuple (float,float)
:param fs: sampling rate
:type fs: float
:param pad: padding before the first and after the last event in seconds
:type pad: float
:param kwargs: arguments for <a class="reference internal" href="#pypillometry.fakedata.generate_pupil_data" title="pypillometry.fakedata.generate_pupil_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">pypillometry.fakedata.generate_pupil_data()</span></code></a>
:type kwargs: dict</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>tx, sy</strong> (<em>np.array</em>) – time and simulated pupil-dilation (n)</p></li>
<li><p><strong>baseline</strong> (<em>np.array</em>) – baseline (n)</p></li>
<li><p><strong>event_onsets</strong> (<em>np.array</em>) – timing of the simulated event-onsets (stimuli and responses not separated)</p></li>
<li><p><strong>response_coef</strong> (<em>np.array</em>) – pupil-response strengths (len(event_onsets))</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</div>
<span class="target" id="module-pypillometry.baseline"></span><div class="section" id="baseline-py">
<h3>baseline.py<a class="headerlink" href="#baseline-py" title="Permalink to this headline">¶</a></h3>
<p>Functions for estimating tonic pupillary fluctuations (baseline).</p>
<dl class="function">
<dt id="pypillometry.baseline.baseline_envelope">
<code class="sig-prename descclassname">pypillometry.baseline.</code><code class="sig-name descname">baseline_envelope</code><span class="sig-paren">(</span><em class="sig-param">tx</em>, <em class="sig-param">sy</em>, <em class="sig-param">event_onsets</em>, <em class="sig-param">fs=1000</em>, <em class="sig-param">lp=2</em>, <em class="sig-param">prominence_thr=80</em>, <em class="sig-param">interp_method='cubic'</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.baseline.baseline_envelope" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract baseline based on the lower envelope of the (filtered) signal.</p>
<p>Steps:</p>
<ul class="simple">
<li><p>filter away noise</p></li>
<li><p>detect high-prominence throughs in the signal</p></li>
<li><p>calculate lower envelope based on these peaks</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx</strong> (<em>np.ndarray</em>) – time-vector in seconds</p></li>
<li><p><strong>sy</strong> (<em>np.ndarray</em>) – raw pupil signal</p></li>
<li><p><strong>event_onsets</strong> (<em>list</em>) – onsets of events (stimuli/responses) in seconds</p></li>
<li><p><strong>fs</strong> (<em>float</em>) – sampling rate in Hz</p></li>
<li><p><strong>lp</strong> (<em>float</em>) – low-pass filter cutoff for removing random noise</p></li>
<li><p><strong>prominence_thr</strong> (<em>float in</em><em> [</em><em>0</em><em>,</em><em>100</em><em>]</em>) – percentile of the prominence distribution (of the peaks) to
use for determining prominent peaks (see <cite>scipy.stats.peak_prominences()</cite>)</p></li>
<li><p><strong>interp_method</strong> (<em>string</em><em>, </em><em>one of</em><em> [</em><em>&quot;linear&quot;</em><em>, </em><em>&quot;cubic&quot;</em><em>, </em><em>&quot;spline&quot;</em><em>]</em>) – <p>“linear” - linear interpolation between the high-prominence peaks
“cubic”  - cubic interpolation through all high-prominence peaks
“spline” - a smoothing spline that is guaranteed to go through all</p>
<blockquote>
<div><p>high-prominence peaks and smoothes through all the other
(lower-prominence) peaks</p>
</div></blockquote>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>base</strong> – baseline estimate</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pypillometry.baseline.baseline_envelope_iter_bspline">
<code class="sig-prename descclassname">pypillometry.baseline.</code><code class="sig-name descname">baseline_envelope_iter_bspline</code><span class="sig-paren">(</span><em class="sig-param">tx</em>, <em class="sig-param">sy</em>, <em class="sig-param">event_onsets</em>, <em class="sig-param">fs</em>, <em class="sig-param">fsd=10</em>, <em class="sig-param">lp=2</em>, <em class="sig-param">lam_sig=1</em>, <em class="sig-param">lam_min=1</em>, <em class="sig-param">lam_max=100</em>, <em class="sig-param">verbose=0</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.baseline.baseline_envelope_iter_bspline" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract baseline based (re-)estimating the lower envelope using B-splines.
See notebook <cite>baseline_interp.ipynb</cite> for details.
The signal is downsampled (to <cite>fsd</cite> Hz) for speed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx</strong> (<em>np.ndarray</em>) – time-vector in seconds</p></li>
<li><p><strong>sy</strong> (<em>np.ndarray</em>) – raw pupil signal</p></li>
<li><p><strong>event_onsets</strong> (<em>list</em>) – onsets of events (stimuli/responses) in seconds</p></li>
<li><p><strong>fs</strong> (<em>float</em>) – sampling rate in Hz</p></li>
<li><p><strong>fsd</strong> (<em>float</em>) – downsampled sampling rate (if too slow, decrease)</p></li>
<li><p><strong>lp</strong> (<em>float</em>) – lowpass-filter cutoff (Hz)</p></li>
<li><p><strong>lam_sig</strong> (<em>float</em>) – parameter steering how much the baseline is shaped by the non-peaks of the signal</p></li>
<li><p><strong>lam_min</strong><strong>,</strong><strong>lam_max</strong> (<em>float</em>) – parameters mapping how much low- and high-prominence peaks influence the baseline</p></li>
<li><p><strong>verbose</strong> (<em>int</em><em> [</em><em>0</em><em>, </em><em>100</em><em>]</em>) – how much information to print (0 nothing, 100 everything)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>(txd,syd,base2,base1)</strong> – txd: downsampled time-array
syd: downsampled and lowpass-filtered pupil signal
base1: is the estimated base after the first round
base2: is the final baseline estimate</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pypillometry.baseline.baseline_pupil_model">
<code class="sig-prename descclassname">pypillometry.baseline.</code><code class="sig-name descname">baseline_pupil_model</code><span class="sig-paren">(</span><em class="sig-param">tx</em>, <em class="sig-param">sy</em>, <em class="sig-param">event_onsets</em>, <em class="sig-param">fs=1000</em>, <em class="sig-param">lp1=2</em>, <em class="sig-param">lp2=0.2</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.baseline.baseline_pupil_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract baseline based on filtering after removing stim-locked activity.</p>
<p>Steps:</p>
<ul class="simple">
<li><p>filter away noise</p></li>
<li><p>regress out event-locked activity from the filtered signal using NNLS</p></li>
<li><p>remove modeled signal from filtered data</p></li>
<li><p>run another lowpass-filter to get rid of spurious signals</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx</strong> (<em>np.ndarray</em>) – time-vector in seconds</p></li>
<li><p><strong>sy</strong> (<em>np.ndarray</em>) – raw pupil signal</p></li>
<li><p><strong>event_onsets</strong> (<em>list</em>) – onsets of events (stimuli/responses) in seconds</p></li>
<li><p><strong>fs</strong> (<em>float</em>) – sampling rate in Hz</p></li>
<li><p><strong>lp1</strong> (<em>float</em>) – low-pass filter cutoff for removing random noise</p></li>
<li><p><strong>lp2</strong> (<em>float</em>) – low-pass filter cutoff for removing spurious peaks from the baseline-signal</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>base</strong> – baseline estimate</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pypillometry.baseline.bspline">
<code class="sig-prename descclassname">pypillometry.baseline.</code><code class="sig-name descname">bspline</code><span class="sig-paren">(</span><em class="sig-param">txd</em>, <em class="sig-param">knots</em>, <em class="sig-param">spline_degree=3</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.baseline.bspline" title="Permalink to this definition">¶</a></dt>
<dd><p>Re-implementation from <a class="reference external" href="https://mc-stan.org/users/documentation/case-studies/splines_in_stan.html">https://mc-stan.org/users/documentation/case-studies/splines_in_stan.html</a>.
Similar behaviour as R’s bs() function from the splines-library.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>txd</strong> (<em>np.array</em>) – time-vector</p></li>
<li><p><strong>knots</strong> (<em>np.array</em>) – location of the knots</p></li>
<li><p><strong>spline_degree</strong> (<em>int</em>) – degree of the spline</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>B</strong> – matrix of basis functions</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pypillometry.baseline.butter_lowpass">
<code class="sig-prename descclassname">pypillometry.baseline.</code><code class="sig-name descname">butter_lowpass</code><span class="sig-paren">(</span><em class="sig-param">cutoff</em>, <em class="sig-param">fs</em>, <em class="sig-param">order=5</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.baseline.butter_lowpass" title="Permalink to this definition">¶</a></dt>
<dd><p>Get lowpass-filter coefficients for Butterworth-filter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cutoff</strong> (<em>float</em>) – lowpass-filter cutoff</p></li>
<li><p><strong>fs</strong> (<em>float</em>) – sampling rate</p></li>
<li><p><strong>order</strong> (<em>int</em>) – filter order</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>(b,a)</strong> – filter coefficients</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tuple (float,float)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pypillometry.baseline.butter_lowpass_filter">
<code class="sig-prename descclassname">pypillometry.baseline.</code><code class="sig-name descname">butter_lowpass_filter</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">cutoff</em>, <em class="sig-param">fs</em>, <em class="sig-param">order=5</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.baseline.butter_lowpass_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Lowpass-filter signal using a Butterworth-filter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>np.array</em>) – data to lowpass-filter</p></li>
<li><p><strong>cutoff</strong> (<em>float</em>) – lowpass-filter cutoff</p></li>
<li><p><strong>fs</strong> (<em>float</em>) – sampling rate</p></li>
<li><p><strong>order</strong> (<em>int</em>) – filter order</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>y</strong> – filtered data</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pypillometry.baseline.downsample">
<code class="sig-prename descclassname">pypillometry.baseline.</code><code class="sig-name descname">downsample</code><span class="sig-paren">(</span><em class="sig-param">y</em>, <em class="sig-param">R</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.baseline.downsample" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple downsampling scheme using mean within the downsampling window.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y</strong> (<em>np.array</em>) – signal to downsample</p></li>
<li><p><strong>R</strong> (<em>int</em>) – decimate-factor</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>y</strong> – downsampled data</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array</p>
</dd>
</dl>
</dd></dl>

</div>
<span class="target" id="module-pypillometry.pupil"></span><div class="section" id="pupil-py">
<h3>pupil.py<a class="headerlink" href="#pupil-py" title="Permalink to this headline">¶</a></h3>
<p>functions related to pupillary responses.</p>
<dl class="function">
<dt id="pypillometry.pupil.pupil_build_design_matrix">
<code class="sig-prename descclassname">pypillometry.pupil.</code><code class="sig-name descname">pupil_build_design_matrix</code><span class="sig-paren">(</span><em class="sig-param">tx</em>, <em class="sig-param">event_onsets</em>, <em class="sig-param">fs</em>, <em class="sig-param">npar</em>, <em class="sig-param">tmax</em>, <em class="sig-param">max_duration='estimate'</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.pupil.pupil_build_design_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct design matrix (nevents x n).
Each column has a single pupil-kernel with parameters <cite>npar</cite>, <cite>tmax</cite> starting at
each <cite>event_onset</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx</strong> (<em>np.array</em>) – in ms</p></li>
<li><p><strong>event_onsets</strong> (<em>np.array</em>) – timing of the events</p></li>
<li><p><strong>fs</strong> (<em>float</em>) – sampling rate (Hz)</p></li>
<li><p><strong>npar</strong> (<em>float</em>) – n in the equation of <a class="reference internal" href="#pypillometry.pupil.pupil_kernel" title="pypillometry.pupil.pupil_kernel"><code class="xref py py-func docutils literal notranslate"><span class="pre">pypillometry.pupil.pupil_kernel()</span></code></a></p></li>
<li><p><strong>tmax</strong> (<em>float</em>) – t_{max} in <a class="reference internal" href="#pypillometry.pupil.pupil_kernel" title="pypillometry.pupil.pupil_kernel"><code class="xref py py-func docutils literal notranslate"><span class="pre">pypillometry.pupil.pupil_kernel()</span></code></a></p></li>
<li><p><strong>max_duration</strong> (<em>float</em><em> or </em><em>&quot;estimate&quot;</em>) – either maximum duration in milliseconds or string “estimate” which
causes the function to determine an appropriate duration based on the
kernel parameters <cite>npar</cite> and <cite>tmax</cite></p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>x1</strong> – design matrix</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array (nevents x n)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pypillometry.pupil.pupil_get_max_duration">
<code class="sig-prename descclassname">pypillometry.pupil.</code><code class="sig-name descname">pupil_get_max_duration</code><span class="sig-paren">(</span><em class="sig-param">npar</em>, <em class="sig-param">tmax</em>, <em class="sig-param">thr=1e-08</em>, <em class="sig-param">stepsize=1.0</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.pupil.pupil_get_max_duration" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the time when the PRF with parameters <span class="math notranslate nohighlight">\(n\)</span> and <span class="math notranslate nohighlight">\(t_{max}\)</span> is decayed to
<cite>thr</cite>. This gives an indication of how long the <cite>duration</cite> parameter
in <a class="reference internal" href="#pypillometry.pupil.pupil_kernel" title="pypillometry.pupil.pupil_kernel"><code class="xref py py-func docutils literal notranslate"><span class="pre">pupil_kernel()</span></code></a> should be chosen.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>npar</strong><strong>,</strong><strong>tmax</strong> (<em>float</em>) – PRF parameters, see <a class="reference internal" href="#pypillometry.pupil.pupil_kernel" title="pypillometry.pupil.pupil_kernel"><code class="xref py py-func docutils literal notranslate"><span class="pre">pupil_kernel()</span></code></a></p></li>
<li><p><strong>thr</strong> (<em>float</em>) – desired value to which the PRF is decayed (the lower <cite>thr</cite>, the longer the duration)</p></li>
<li><p><strong>stepsize</strong> (<em>float</em>) – precision of the maximum duration in ms</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>tdur</strong> – first value of t so that PRF(t)&lt;<cite>thr</cite></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pypillometry.pupil.pupil_kernel">
<code class="sig-prename descclassname">pypillometry.pupil.</code><code class="sig-name descname">pupil_kernel</code><span class="sig-paren">(</span><em class="sig-param">duration=4000</em>, <em class="sig-param">fs=1000</em>, <em class="sig-param">npar=10.1</em>, <em class="sig-param">tmax=930.0</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.pupil.pupil_kernel" title="Permalink to this definition">¶</a></dt>
<dd><p>According to Hoeks and Levelt (1993,
<a class="reference external" href="https://link.springer.com/content/pdf/10.3758%2FBF03204445.pdf">https://link.springer.com/content/pdf/10.3758%2FBF03204445.pdf</a>),
the PRF can be described by the so-called Erlang gamma function
$$h_{HL}(t) = t^n e^{-nt/t_{max}}$$
which we normalize to
$$h(t)=\frac{1}{h_{max}} h_{HL}(t)$$
where $$h_{max} = \max_t{\left(h_{HL}(t)\right)} = e^{-n}t_{max}^{n}$$
which yields a maximum value of 1 for this function.
The function <span class="math notranslate nohighlight">\(h(t)\)</span> is implemented in <cite>pp.pupil_kernel()</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>duration</strong> (<em>float</em>) – in ms; maximum of the time window for which to calculate the PRF [0,duration]</p></li>
<li><p><strong>fs</strong> (<em>float</em>) – sampling rate for resolving the PRF</p></li>
<li><p><strong>npar</strong> (<em>float</em>) – n in the equation above</p></li>
<li><p><strong>tmax</strong> (<em>float</em>) – t_{max} in the equation above</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>h</strong> – sampled version of h(t) over the interval [0,`duration`] with sampling rate <cite>fs</cite></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pypillometry.pupil.pupil_kernel_t">
<code class="sig-prename descclassname">pypillometry.pupil.</code><code class="sig-name descname">pupil_kernel_t</code><span class="sig-paren">(</span><em class="sig-param">t</em>, <em class="sig-param">npar</em>, <em class="sig-param">tmax</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.pupil.pupil_kernel_t" title="Permalink to this definition">¶</a></dt>
<dd><p>According to Hoeks and Levelt (1993,
<a class="reference external" href="https://link.springer.com/content/pdf/10.3758%2FBF03204445.pdf">https://link.springer.com/content/pdf/10.3758%2FBF03204445.pdf</a>),
the PRF can be described by the so-called Erlang gamma function
$$h_{HL}(t) = t^n e^{-nt/t_{max}}$$
which we normalize to
$$h(t)=\frac{1}{h_{max}} h_{HL}(t)$$
where $$h_{max} = \max_t{\left(h_{HL}(t)\right)} = e^{-n}t_{max}^{n}$$
which yields a maximum value of 1 for this function.
The function <span class="math notranslate nohighlight">\(h(t)\)</span> is implemented in <a class="reference internal" href="#pypillometry.pupil.pupil_kernel" title="pypillometry.pupil.pupil_kernel"><code class="xref py py-func docutils literal notranslate"><span class="pre">pupil_kernel()</span></code></a>.</p>
<p>This version of the function evaluates the PRF at inputs <cite>t</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>t</strong> (<em>float/np.array</em>) – in ms</p></li>
<li><p><strong>npar</strong> (<em>float</em>) – n in the equation above</p></li>
<li><p><strong>tmax</strong> (<em>float</em>) – t_{max} in the equation above</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>h</strong> – PRF evaluated at <cite>t</cite></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pypillometry.pupil.pupil_response">
<code class="sig-prename descclassname">pypillometry.pupil.</code><code class="sig-name descname">pupil_response</code><span class="sig-paren">(</span><em class="sig-param">tx</em>, <em class="sig-param">sy</em>, <em class="sig-param">event_onsets</em>, <em class="sig-param">fs</em>, <em class="sig-param">npar='free'</em>, <em class="sig-param">tmax='free'</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.pupil.pupil_response" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimate pupil-response based on event-onsets.</p>
<dl class="simple">
<dt>tx<span class="classifier">np.ndarray</span></dt><dd><p>time-vector in milliseconds</p>
</dd>
<dt>sy<span class="classifier">np.ndarray</span></dt><dd><p>(baseline-corrected) pupil signal</p>
</dd>
<dt>event_onsets<span class="classifier">list</span></dt><dd><p>onsets of events (stimuli/responses) in milliseconds</p>
</dd>
<dt>fs<span class="classifier">float</span></dt><dd><p>sampling rate in Hz</p>
</dd>
<dt>npar: float</dt><dd><p>npar-parameter for the canonical response-function or “free”;
in case of “free”, the function optimizes for this parameter</p>
</dd>
<dt>tmax: float</dt><dd><p>tmax-parameter for the canonical response-function or “free”;
in case of “free”, the function optimizes for this parameter</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pypillometry.pupil.pupilresponse_nnls">
<code class="sig-prename descclassname">pypillometry.pupil.</code><code class="sig-name descname">pupilresponse_nnls</code><span class="sig-paren">(</span><em class="sig-param">tx</em>, <em class="sig-param">sy</em>, <em class="sig-param">event_onsets</em>, <em class="sig-param">fs</em>, <em class="sig-param">npar=10.1</em>, <em class="sig-param">tmax=930</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.pupil.pupilresponse_nnls" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimate single-event pupil responses based on canonical PRF (<cite>pupil_kernel()</cite>)
using non-negative least-squares (NNLS).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx</strong> (<em>np.ndarray</em>) – time-vector in milliseconds</p></li>
<li><p><strong>sy</strong> (<em>np.ndarray</em>) – (baseline-corrected) pupil signal</p></li>
<li><p><strong>event_onsets</strong> (<em>list</em>) – onsets of events (stimuli/responses) in seconds</p></li>
<li><p><strong>fs</strong> (<em>float</em>) – sampling rate in Hz</p></li>
<li><p><strong>npar</strong><strong>,</strong><strong>tmax</strong> (<em>float</em>) – parameters for <a class="reference internal" href="#pypillometry.pupil.pupil_kernel" title="pypillometry.pupil.pupil_kernel"><code class="xref py py-func docutils literal notranslate"><span class="pre">pypillometry.pupil.pupil_kernel()</span></code></a></p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>(coef,pred,resid)</strong> – coef: purely-positive regression coefficients
pred: predicted signal
resid: residuals (sy-pred)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

</div>
<span class="target" id="module-pypillometry.convenience"></span><div class="section" id="convenience-py">
<h3>convenience.py<a class="headerlink" href="#convenience-py" title="Permalink to this headline">¶</a></h3>
<p>Some convenience functions.</p>
<dl class="function">
<dt id="pypillometry.convenience.StanModel_cache">
<code class="sig-prename descclassname">pypillometry.convenience.</code><code class="sig-name descname">StanModel_cache</code><span class="sig-paren">(</span><em class="sig-param">model_code</em>, <em class="sig-param">model_name=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.convenience.StanModel_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Use just as you would <cite>stan</cite></p>
</dd></dl>

<dl class="function">
<dt id="pypillometry.convenience.p_asym_laplac">
<code class="sig-prename descclassname">pypillometry.convenience.</code><code class="sig-name descname">p_asym_laplac</code><span class="sig-paren">(</span><em class="sig-param">y</em>, <em class="sig-param">mu</em>, <em class="sig-param">sigma</em>, <em class="sig-param">tau</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.convenience.p_asym_laplac" title="Permalink to this definition">¶</a></dt>
<dd><p>Asymmetric laplace distribution <a class="reference external" href="https://en.wikipedia.org/wiki/Asymmetric_Laplace_distribution">https://en.wikipedia.org/wiki/Asymmetric_Laplace_distribution</a>;
Parametrization as here: <a class="reference external" href="https://github.com/stan-dev/stan/issues/2312">https://github.com/stan-dev/stan/issues/2312</a></p>
<p>tau in [0,1]</p>
</dd></dl>

<dl class="function">
<dt id="pypillometry.convenience.p_asym_laplac_kappa">
<code class="sig-prename descclassname">pypillometry.convenience.</code><code class="sig-name descname">p_asym_laplac_kappa</code><span class="sig-paren">(</span><em class="sig-param">y</em>, <em class="sig-param">mu</em>, <em class="sig-param">lam</em>, <em class="sig-param">kappa</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.convenience.p_asym_laplac_kappa" title="Permalink to this definition">¶</a></dt>
<dd><p>Asymmetric laplace distribution <a class="reference external" href="https://en.wikipedia.org/wiki/Asymmetric_Laplace_distribution">https://en.wikipedia.org/wiki/Asymmetric_Laplace_distribution</a>;
Wikipedia parametrization.</p>
<p>kappa in [0, infty] where 1 means symmetry</p>
</dd></dl>

<dl class="function">
<dt id="pypillometry.convenience.plot_pupil_ipy">
<code class="sig-prename descclassname">pypillometry.convenience.</code><code class="sig-name descname">plot_pupil_ipy</code><span class="sig-paren">(</span><em class="sig-param">tx</em>, <em class="sig-param">sy</em>, <em class="sig-param">event_onsets=None</em>, <em class="sig-param">overlays=None</em>, <em class="sig-param">overlay_labels=None</em>, <em class="sig-param">figsize=(16</em>, <em class="sig-param">8)</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.convenience.plot_pupil_ipy" title="Permalink to this definition">¶</a></dt>
<dd><p>Plotting with interactive adjustment of plotting window.
To use this, do</p>
<p>$ pip install ipywidgets
$ jupyter nbextension enable –py widgetsnbextension
$ jupyter labextension install &#64;jupyter-widgets/jupyterlab-manager</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tx</strong> (<em>np.ndarray</em>) – time-vector in seconds</p></li>
<li><p><strong>sy</strong> (<em>np.ndarray</em>) – raw pupil signal</p></li>
<li><p><strong>event_onsets</strong> (<em>list</em>) – onsets of events (stimuli/responses) in seconds</p></li>
<li><p><strong>overlays</strong> (<em>tuple of np.array</em>) – signals to overlay over the plot, given as tuple of arrays of same length as <cite>tx</cite></p></li>
<li><p><strong>overlay_labels</strong> (<em>tuple of strings</em>) – labels for the overlays to be displayed in the legend</p></li>
<li><p><strong>figsize</strong> (<em>tuple of int</em>) – dimensions for the plot</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pypillometry.convenience.trans_logistic_vec">
<code class="sig-prename descclassname">pypillometry.convenience.</code><code class="sig-name descname">trans_logistic_vec</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">a</em>, <em class="sig-param">b</em>, <em class="sig-param">inverse=False</em><span class="sig-paren">)</span><a class="headerlink" href="#pypillometry.convenience.trans_logistic_vec" title="Permalink to this definition">¶</a></dt>
<dd><p>vectorized version of trans_logistic()</p>
<p>goes from [a,b] to [-inf,+inf] and back;
inverse=False: [a,b] -&gt; [-inf, +inf]
inverse=True:  [-inf,+inf] -&gt; [a,b]
if a or b is +/-infty, a logarithmic/exponential transform is used</p>
</dd></dl>

</div>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="#">
              <img class="logo" src="_static/pypillometry_logo_200x200.png" alt="Logo"/>
            </a></p>
  <h3><a href="#">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Welcome to pypillometry’s documentation!</a></li>
<li><a class="reference internal" href="#pypillometry">pypillometry</a><ul>
<li><a class="reference internal" href="#setup">Setup</a><ul>
<li><a class="reference internal" href="#using-conda">Using <code class="docutils literal notranslate"><span class="pre">conda</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-pypillometry.fakedata">API documentation</a><ul>
<li><a class="reference internal" href="#fakedata-py">fakedata.py</a></li>
<li><a class="reference internal" href="#baseline-py">baseline.py</a></li>
<li><a class="reference internal" href="#pupil-py">pupil.py</a></li>
<li><a class="reference internal" href="#convenience-py">convenience.py</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">pypillometry  documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Matthias Mittner.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.
    </div>
  </body>
</html>